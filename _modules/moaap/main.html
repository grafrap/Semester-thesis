

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>moaap.main &mdash; MOAAP  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MOAAP
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">MOAAP Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">MOAAP: Multi-Object Analysis of Atmospheric Phenomena - Tutorial</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MOAAP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">moaap.main</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for moaap.main</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">moaap.utils.grid</span><span class="w"> </span><span class="kn">import</span> <span class="n">calc_grid_distance_area</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">moaap.utils.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">g</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">beta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.trackers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ar_ivt_tracking</span><span class="p">,</span> <span class="n">ar_850hpa_tracking</span><span class="p">,</span> <span class="n">ar_check</span><span class="p">,</span>
    <span class="n">cloud_tracking</span><span class="p">,</span> <span class="n">mcs_tb_tracking</span><span class="p">,</span>
    <span class="n">cy_acy_psl_tracking</span><span class="p">,</span> <span class="n">cy_acy_z500_tracking</span><span class="p">,</span> <span class="n">col_identification</span><span class="p">,</span>
    <span class="n">frontal_identification</span><span class="p">,</span>
    <span class="n">jetstream_tracking</span><span class="p">,</span>
    <span class="n">tc_tracking</span><span class="p">,</span>
    <span class="n">track_tropwaves_tb</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">moaap.utils.object_props</span><span class="w"> </span><span class="kn">import</span> <span class="n">calc_object_characteristics</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">moaap.utils.profiling</span><span class="w"> </span><span class="kn">import</span> <span class="n">timer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">moaap.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">MOAAP_DEFAULTS</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">metpy.calc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">calc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">metpy.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span>



<div class="viewcode-block" id="moaap">
<a class="viewcode-back" href="../../modules.html#moaap.main.moaap">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">moaap</span><span class="p">(</span>
    <span class="n">Lon</span><span class="p">,</span>                           <span class="c1"># 2D longitude grid centers</span>
    <span class="n">Lat</span><span class="p">,</span>                           <span class="c1"># 2D latitude grid spacing</span>
    <span class="n">Time</span><span class="p">,</span>                          <span class="c1"># datetime vector of data</span>
    <span class="n">dT</span><span class="p">,</span>                            <span class="c1"># integer - temporal frequency of data [hour]</span>
    <span class="n">Mask</span><span class="p">,</span>                          <span class="c1"># mask with dimensions [lat,lon] defining analysis region</span>
    <span class="o">*</span><span class="p">,</span> 
    <span class="n">config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
    <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Lon : array_like</span>
<span class="sd">        2D array of longitude grid centers.</span>
<span class="sd">    Lat : array_like</span>
<span class="sd">        2D array of latitude grid centers.</span>
<span class="sd">    Time : array_like of datetime</span>
<span class="sd">        1D vector of datetimes for each time step.</span>
<span class="sd">    dT : int</span>
<span class="sd">        Temporal frequency of the data in hours.</span>
<span class="sd">    Mask : array_like</span>
<span class="sd">        2D mask defining the analysis region.</span>

<span class="sd">    Keyword Arguments</span>
<span class="sd">    -----------------</span>
<span class="sd">    v850 : array_like or None, default=None</span>
<span class="sd">        850 hPa zonal wind speed (m/s).</span>
<span class="sd">    u850 : array_like or None, default=None</span>
<span class="sd">        850 hPa meridional wind speed (m/s).</span>
<span class="sd">    t850 : array_like or None, default=None</span>
<span class="sd">        850 hPa air temperature (K).</span>
<span class="sd">    q850 : array_like or None, default=None</span>
<span class="sd">        850 hPa mixing ratio (g/kg).</span>
<span class="sd">    slp : array_like or None, default=None</span>
<span class="sd">        Sea level pressure (Pa).</span>
<span class="sd">    ivte : array_like or None, default=None</span>
<span class="sd">        Zonal integrated vapor transport (kg m⁻¹ s⁻¹).</span>
<span class="sd">    ivtn : array_like or None, default=None</span>
<span class="sd">        Meridional integrated vapor transport (kg m⁻¹ s⁻¹).</span>
<span class="sd">    z500 : array_like or None, default=None</span>
<span class="sd">        Geopotential height at 500 hPa (gpm).</span>
<span class="sd">    v200 : array_like or None, default=None</span>
<span class="sd">        200 hPa zonal wind speed (m/s).</span>
<span class="sd">    u200 : array_like or None, default=None</span>
<span class="sd">        200 hPa meridional wind speed (m/s).</span>
<span class="sd">    pr : array_like or None, default=None</span>
<span class="sd">        Accumulated surface precipitation (mm per time step).</span>
<span class="sd">    tb : array_like or None, default=None</span>
<span class="sd">        Brightness temperature (K).</span>
<span class="sd">    DataName : str, default=&#39;&#39;</span>
<span class="sd">        Name of the common grid.</span>
<span class="sd">    OutputFolder : str, default=&#39;&#39;</span>
<span class="sd">        Path to the output directory.</span>

<span class="sd">    Precipitation objects</span>
<span class="sd">    -----------        </span>
<span class="sd">    SmoothSigmaP : float, default=0</span>
<span class="sd">        Gaussian σ for precipitation smoothing.</span>
<span class="sd">    Pthreshold : float, default=2</span>
<span class="sd">        Precipitation threshold (mm h⁻¹).</span>
<span class="sd">    MinTimePR : int, default=4</span>
<span class="sd">        Minimum lifetime of precipitation features (h).</span>
<span class="sd">    MinAreaPR : float, default=5000</span>
<span class="sd">        Minimum area of precipitation features (km²).</span>

<span class="sd">    Moisture streams</span>
<span class="sd">    -----------</span>
<span class="sd">    MinTimeMS : int, default=9</span>
<span class="sd">        Minimum lifetime of moisture stream features (h).</span>
<span class="sd">    MinAreaMS : float, default=100000</span>
<span class="sd">        Minimum area of moisture stream features (km²).</span>
<span class="sd">    MinMSthreshold : float, default=0.11</span>
<span class="sd">        Detection threshold for moisture streams (g·m/g·s).</span>

<span class="sd">    Cyclones &amp; anticyclones</span>
<span class="sd">    -------------------</span>
<span class="sd">    MinTimeCY : int, default=12</span>
<span class="sd">        Minimum lifetime of cyclones (h).</span>
<span class="sd">    MaxPresAnCY : float, default=-8</span>
<span class="sd">        Pressure anomaly threshold for cyclones (hPa).</span>
<span class="sd">    breakup_cy : str, default=&#39;watershed&#39;</span>
<span class="sd">        Method for cyclone breakup.</span>
<span class="sd">    MinTimeACY : int, default=12</span>
<span class="sd">        Minimum lifetime of anticyclones (h).</span>
<span class="sd">    MinPresAnACY : float, default=6</span>
<span class="sd">        Pressure anomaly threshold for anticyclones (hPa).</span>

<span class="sd">    Frontal zones</span>
<span class="sd">    -------------------</span>
<span class="sd">    MinAreaFR : float, default=50000</span>
<span class="sd">        Minimum area of frontal zones (km²).</span>
<span class="sd">    front_treshold : float, default=1</span>
<span class="sd">        Threshold for masking frontal zones.</span>

<span class="sd">    Cloud tracking</span>
<span class="sd">    -----------</span>
<span class="sd">    SmoothSigmaC : float, default=0</span>
<span class="sd">        Gaussian σ for cloud‐shield smoothing.</span>
<span class="sd">    Cthreshold : float, default=241</span>
<span class="sd">        Brightness temperature threshold for ice‐cloud shields (K).</span>
<span class="sd">    MinTimeC : int, default=4</span>
<span class="sd">        Minimum lifetime of ice‐cloud shields (h).</span>
<span class="sd">    MinAreaC : float, default=40000</span>
<span class="sd">        Minimum area of ice‐cloud shields (km²).</span>

<span class="sd">    Atmospheric rivers (AR)</span>
<span class="sd">    -----------</span>
<span class="sd">    IVTtrheshold : float, default=500</span>
<span class="sd">        Integrated vapor transport threshold for AR detection (kg m⁻¹ s⁻¹).</span>
<span class="sd">    MinTimeIVT : int, default=12</span>
<span class="sd">        Minimum lifetime of ARs (h).</span>
<span class="sd">    breakup_ivt : str, default=&#39;watershed&#39;</span>
<span class="sd">        Method for AR breakup.</span>
<span class="sd">    AR_MinLen : float, default=2000</span>
<span class="sd">        Minimum length of an AR (km).</span>
<span class="sd">    AR_Lat : float, default=20</span>
<span class="sd">        Minimum centroid latitude for ARs (degrees N).</span>
<span class="sd">    AR_width_lenght_ratio : float, default=2</span>
<span class="sd">        Minimum length‐to‐width ratio for ARs.</span>

<span class="sd">    Tropical cyclone detection</span>
<span class="sd">    -----------</span>
<span class="sd">    TC_Pmin : float, default=995</span>
<span class="sd">        Minimum central pressure for TC detection (hPa).</span>
<span class="sd">    TC_lat_genesis : float, default=35</span>
<span class="sd">        Maximum latitude for TC genesis (degrees).</span>
<span class="sd">    TC_lat_max : float, default=60</span>
<span class="sd">        Maximum latitude for TC existence (degrees).</span>
<span class="sd">    TC_deltaT_core : float, default=0</span>
<span class="sd">        Minimum core‐to‐environment temperature difference (K).</span>
<span class="sd">    TC_T850min : float, default=285</span>
<span class="sd">        Minimum core temperature at 850 hPa for TCs (K).</span>

<span class="sd">    Mesoscale convective systems (MCS)</span>
<span class="sd">    -----------</span>
<span class="sd">    MCS_Minsize : float, default=5000</span>
<span class="sd">        Minimum precipitation area size for MCS (km²).</span>
<span class="sd">    MCS_minPR : float, default=15</span>
<span class="sd">        Precipitation threshold for MCS detection (mm h⁻¹).</span>
<span class="sd">    CL_MaxT : float, default=215</span>
<span class="sd">        Maximum brightness temperature in ice shield for MCS (K).</span>
<span class="sd">    CL_Area : float, default=40000</span>
<span class="sd">        Minimum cloud area for MCS detection (km²).</span>
<span class="sd">    MCS_minTime : int, default=4</span>
<span class="sd">        Minimum lifetime of MCS (h).</span>
<span class="sd">    Analyze_history : bool, default=False</span>
<span class="sd">        Whether to analyze the history of MCS objects.</span>

<span class="sd">    Jet streams &amp; tropical waves</span>
<span class="sd">    -----------</span>
<span class="sd">    js_min_anomaly : float, default=37</span>
<span class="sd">        Minimum jet‐stream anomaly (m/s).</span>
<span class="sd">    MinTimeJS : int, default=24</span>
<span class="sd">        Minimum lifetime of jet streams (h).</span>
<span class="sd">    breakup_jet : str, default=&#39;watershed&#39;</span>
<span class="sd">        Method for jet‐stream breakup.</span>
<span class="sd">    tropwave_minTime : int, default=48</span>
<span class="sd">        Minimum lifetime of tropical waves (h).</span>
<span class="sd">    breakup_mcs : str, default=&#39;watershed&#39;</span>
<span class="sd">        Method for MCS breakup.</span>

<span class="sd">    **500 hPa cyclones/anticyclones**</span>

<span class="sd">    z500_low_anom : float, default=-80</span>
<span class="sd">        Minimum anomaly for 500 hPa cyclones (m).</span>
<span class="sd">    z500_high_anom : float, default=70</span>
<span class="sd">        Minimum anomaly for 500 hPa anticyclones (m).</span>
<span class="sd">    breakup_zcy : str, default=&#39;watershed&#39;</span>
<span class="sd">        Method for 500 hPa cyclone/anticyclone breakup.</span>

<span class="sd">    Equatorial waves</span>
<span class="sd">    -----------</span>
<span class="sd">    er_th : float, default=0.05</span>
<span class="sd">        Threshold for equatorial Rossby waves.</span>
<span class="sd">    mrg_th : float, default=0.05</span>
<span class="sd">        Threshold for mixed Rossby‐gravity waves.</span>
<span class="sd">    igw_th : float, default=0.20</span>
<span class="sd">        Threshold for inertia–gravity waves.</span>
<span class="sd">    kel_th : float, default=0.10</span>
<span class="sd">        Threshold for Kelvin waves.</span>
<span class="sd">    eig0_th : float, default=0.10</span>
<span class="sd">        Threshold for n≥1 inertia–gravity waves.</span>
<span class="sd">    breakup_tw : str, default=&#39;watershed&#39;</span>
<span class="sd">        Method for equatorial wave breakup.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary containing detected features grouped by type</span>
<span class="sd">        (e.g., &#39;precip&#39;, &#39;moisture&#39;, &#39;cyclones&#39;, etc.).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">params</span> <span class="o">=</span> <span class="n">MOAAP_DEFAULTS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># ... load/merge config_file if given ...</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1"># check if the input variables are np.arrays</span>
    <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;v850&quot;</span><span class="p">,</span>  <span class="s2">&quot;u850&quot;</span><span class="p">,</span>  <span class="s2">&quot;t850&quot;</span><span class="p">,</span>  <span class="s2">&quot;q850&quot;</span><span class="p">,</span>  <span class="s2">&quot;slp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ivte&quot;</span><span class="p">,</span>  <span class="s2">&quot;ivtn&quot;</span><span class="p">,</span>  <span class="s2">&quot;z500&quot;</span><span class="p">,</span>  <span class="s2">&quot;v200&quot;</span><span class="p">,</span>  <span class="s2">&quot;u200&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pr&quot;</span><span class="p">,</span>    <span class="s2">&quot;tb&quot;</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="c1"># Display which variable is wrong, then stop</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; must be a numpy.ndarray, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">v850</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;v850&quot;</span><span class="p">]</span>                   <span class="c1"># 850 hPa zonal wind speed [m/s]</span>
    <span class="n">u850</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;u850&quot;</span><span class="p">]</span>                   <span class="c1"># 850 hPa meridional wind speed [m/s]</span>
    <span class="n">t850</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;t850&quot;</span><span class="p">]</span>                   <span class="c1"># 850 hPa air temperature [K]</span>
    <span class="n">q850</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;q850&quot;</span><span class="p">]</span>                   <span class="c1"># 850 hPa mixing ratio [g/kg]</span>
    <span class="n">slp</span> <span class="o">=</span>  <span class="n">params</span><span class="p">[</span><span class="s2">&quot;slp&quot;</span><span class="p">]</span>                    <span class="c1"># sea level pressure [Pa]</span>
    <span class="n">ivte</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ivte&quot;</span><span class="p">]</span>                   <span class="c1"># zonal integrated vapor transport [kg m-1 s-1]</span>
    <span class="n">ivtn</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ivtn&quot;</span><span class="p">]</span>                   <span class="c1"># meridional integrated vapor transport [kg m-1 s-1]</span>
    <span class="n">z500</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;z500&quot;</span><span class="p">]</span>                   <span class="c1"># geopotential height [gpm]</span>
    <span class="n">v200</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;v200&quot;</span><span class="p">]</span>                   <span class="c1"># 200 hPa zonal wind speed [m/s]</span>
    <span class="n">u200</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;u200&quot;</span><span class="p">]</span>                   <span class="c1"># 200 hPa meridional wind speed [m/s]</span>
    <span class="n">pr</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;pr&quot;</span><span class="p">]</span>                     <span class="c1"># accumulated surface precipitation [mm/time]</span>
    <span class="n">tb</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tb&quot;</span><span class="p">]</span>                     <span class="c1"># brightness temperature [K]</span>
        

    <span class="c1"># calculate grid spacing assuming a regular lat/lon grid</span>
    <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">Area</span><span class="p">,</span><span class="n">Gridspacing</span> <span class="o">=</span> <span class="n">calc_grid_distance_area</span><span class="p">(</span><span class="n">Lon</span><span class="p">,</span><span class="n">Lat</span><span class="p">)</span>
    <span class="n">Area</span><span class="p">[</span><span class="n">Area</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">EarthCircum</span> <span class="o">=</span> <span class="mi">40075000</span> <span class="c1">#[m]</span>
    <span class="n">Lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Lat</span><span class="p">)</span>
    <span class="n">Lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Lon</span><span class="p">)</span>
    <span class="n">dLat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Lon</span><span class="p">);</span> <span class="n">dLat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">EarthCircum</span><span class="o">/</span><span class="p">(</span><span class="mi">360</span><span class="o">/</span><span class="p">(</span><span class="n">Lat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Lat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">dLon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Lon</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">la</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Lat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">dLon</span><span class="p">[</span><span class="n">la</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">EarthCircum</span><span class="o">/</span><span class="p">(</span><span class="mi">360</span><span class="o">/</span><span class="p">(</span><span class="n">Lat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Lat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">Lat</span><span class="p">[</span><span class="n">la</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">dLat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dLat</span><span class="p">)</span>
    <span class="n">dLon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dLon</span><span class="p">)</span>
    
    <span class="n">StartDay</span> <span class="o">=</span> <span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">SetupString</span> <span class="o">=</span> <span class="s1">&#39;_dt-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dT</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;h_MOAAP-masks&#39;</span>
    <span class="n">NCfile</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;DataName&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_ObjectMasks_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="o">+</span><span class="s1">&#39;.nc&#39;</span>
    <span class="n">FrontMask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Mask</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">FrontMask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Lat</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;            latitude does not expand into the tropics&#39;</span><span class="p">)</span>

    <span class="c1"># connect over date line?</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Lon</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">176</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Lon</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">176</span><span class="p">):</span>
        <span class="n">connectLon</span><span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">connectLon</span><span class="o">=</span> <span class="mi">0</span>

    <span class="c1">### print out which phenomenon can be investigated</span>
    <span class="k">if</span> <span class="n">slp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">slp_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">slp_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ivte</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ivtn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">ar_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ar_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v850</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">u850</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t850</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">front_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">front_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">slp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> \
       <span class="o">&amp;</span> <span class="p">(</span><span class="n">t850</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">tc_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tc_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">if</span> <span class="n">z500</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">z500_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z500_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">z500</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">front_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">)</span> <span class="o">&amp;</span> \
       <span class="p">(</span><span class="n">u200</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">col_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">col_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v200</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">u200</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">jet_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">jet_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">mcs_tb_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mcs_tb_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">cloud_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cloud_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">q850</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">v850</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> \
       <span class="p">(</span><span class="n">u850</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">ms_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ms_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">ew_test</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ew_test</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    jet_test =  &#39;no&#39;</span>
<span class="sd">    slp_test = &#39;yes&#39;</span>
<span class="sd">    z500_test =  &#39;no&#39;</span>
<span class="sd">    col_test = &#39;no&#39; </span>
<span class="sd">    ar_test =  &#39;no&#39;</span>
<span class="sd">    ms_test =  &#39;no&#39;</span>
<span class="sd">    front_test =  &#39;no&#39;</span>
<span class="sd">    tc_test = &#39;yes&#39;</span>
<span class="sd">    mcs_tb_test =  &#39;no&#39;</span>
<span class="sd">    cloud_test =  &#39;no&#39;</span>
<span class="sd">    ew_test =  &#39;no&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ew_test</span> <span class="o">=</span>  <span class="s1">&#39;no&#39;</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The provided variables allow tracking the following phenomena&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|  phenomenon  | tracking |&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Jetstream   |   &#39;</span> <span class="o">+</span> <span class="n">jet_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   PSL CY/ACY  |   &#39;</span> <span class="o">+</span> <span class="n">slp_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Z500 CY/ACY |   &#39;</span> <span class="o">+</span> <span class="n">z500_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   COLs        |   &#39;</span> <span class="o">+</span> <span class="n">col_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   IVT ARs     |   &#39;</span> <span class="o">+</span> <span class="n">ar_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   MS ARs      |   &#39;</span> <span class="o">+</span> <span class="n">ms_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Fronts      |   &#39;</span> <span class="o">+</span> <span class="n">front_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   TCs         |   &#39;</span> <span class="o">+</span> <span class="n">tc_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   MCSs        |   &#39;</span> <span class="o">+</span> <span class="n">mcs_tb_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   clouds      |   &#39;</span> <span class="o">+</span> <span class="n">cloud_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Equ. Waves  |   &#39;</span> <span class="o">+</span> <span class="n">ew_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

    
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
    
    <span class="c1"># Mask data outside of Focus domain</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">v850</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">u850</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">t850</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">q850</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">slp</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ivte</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ivtn</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">z500</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">v200</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">u200</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pr</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tb</span><span class="p">[:,</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">jet_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;======&gt; track jetstream&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">uv200</span> <span class="o">=</span> <span class="p">(</span><span class="n">u200</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">v200</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>

        <span class="n">jet_objects</span><span class="p">,</span> <span class="n">object_split</span> <span class="o">=</span> <span class="n">jetstream_tracking</span><span class="p">(</span><span class="n">uv200</span><span class="p">,</span>
                                      <span class="n">params</span><span class="p">[</span><span class="s2">&quot;js_min_anomaly&quot;</span><span class="p">],</span>
                                      <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeJS&quot;</span><span class="p">],</span>
                                      <span class="n">dT</span><span class="p">,</span>
                                      <span class="n">Gridspacing</span><span class="p">,</span>
                                      <span class="n">connectLon</span><span class="p">,</span>
                                      <span class="n">breakup</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;breakup_jet&quot;</span><span class="p">])</span>
        <span class="n">jet_objects_characteristics</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">jet_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                     <span class="n">uv200</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                     <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;jet_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
                                     <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                     <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                     <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                     <span class="n">Gridspacing</span><span class="p">,</span>
                                     <span class="n">Area</span><span class="p">,</span>
                                     <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeJS&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">dT</span><span class="p">),</span>
                                     <span class="n">split_merge</span> <span class="o">=</span> <span class="n">object_split</span><span class="p">)</span>
        
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        
    
    <span class="k">if</span> <span class="n">ew_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;======&gt; track tropical waves&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">mrg_objects</span><span class="p">,</span> <span class="n">igw_objects</span><span class="p">,</span> <span class="n">kelvin_objects</span><span class="p">,</span> <span class="n">eig0_objects</span><span class="p">,</span> <span class="n">er_objects</span> <span class="o">=</span> <span class="n">track_tropwaves_tb</span><span class="p">(</span>
                        <span class="n">tb</span><span class="p">,</span>
                        <span class="n">Lat</span><span class="p">,</span>
                        <span class="n">connectLon</span><span class="p">,</span>
                        <span class="n">dT</span><span class="p">,</span>
                       <span class="n">Gridspacing</span><span class="p">,</span>
                       <span class="n">er_th</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;er_th&quot;</span><span class="p">],</span>  <span class="c1"># threshold for Rossby Waves</span>
                       <span class="n">mrg_th</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;mrg_th&quot;</span><span class="p">],</span> <span class="c1"># threshold for mixed Rossby Gravity Waves</span>
                       <span class="n">igw_th</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;igw_th&quot;</span><span class="p">],</span>  <span class="c1"># threshold for inertia gravity waves</span>
                       <span class="n">kel_th</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;kel_th&quot;</span><span class="p">],</span>  <span class="c1"># threshold for Kelvin waves</span>
                       <span class="n">eig0_th</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;eig0_th&quot;</span><span class="p">],</span> <span class="c1"># threshold for n&gt;=1 Inertio Gravirt Wave</span>
                       <span class="n">breakup</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;breakup_tw&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

        <span class="n">gr_mrg</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">mrg_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                 <span class="n">pr</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                 <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;MRG_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>        <span class="c1"># output file name and locaiton</span>
                                 <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                 <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                 <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                 <span class="n">Gridspacing</span><span class="p">,</span>
                                 <span class="n">Area</span><span class="p">,</span>
                                 <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;tropwave_minTime&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span>      <span class="c1"># minimum livetime in hours</span>
        
        <span class="n">gr_igw</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">igw_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                 <span class="n">pr</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                 <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;IGW_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>        <span class="c1"># output file name and locaiton</span>
                                 <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                 <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                 <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                 <span class="n">Gridspacing</span><span class="p">,</span>
                                 <span class="n">Area</span><span class="p">,</span>
                                 <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">48</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span>      <span class="c1"># minimum livetime in hours</span>
        
        <span class="n">gr_kelvin</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">kelvin_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                 <span class="n">pr</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                 <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;Kelvin_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>        <span class="c1"># output file name and locaiton</span>
                                 <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                 <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                 <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                 <span class="n">Gridspacing</span><span class="p">,</span>
                                 <span class="n">Area</span><span class="p">,</span>
                                 <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">48</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span>      <span class="c1"># minimum livetime in hours</span>
        
        <span class="n">gr_eig0</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">eig0_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                 <span class="n">pr</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                 <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;Eig0_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>        <span class="c1"># output file name and locaiton</span>
                                 <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                 <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                 <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                 <span class="n">Gridspacing</span><span class="p">,</span>
                                 <span class="n">Area</span><span class="p">,</span>
                                 <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">48</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span>      <span class="c1"># minimum livetime in hours</span>
        
        <span class="n">gr_er</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">er_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                 <span class="n">pr</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                 <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;ER_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>        <span class="c1"># output file name and locaiton</span>
                                 <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                 <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                 <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                 <span class="n">Gridspacing</span><span class="p">,</span>
                                 <span class="n">Area</span><span class="p">,</span>
                                 <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">48</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span>      <span class="c1"># minimum livetime in hours</span>
        
        
    <span class="k">if</span> <span class="n">ms_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;======&gt; track moisture streams and atmospheric rivers (ARs)&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">VapTrans</span> <span class="o">=</span> <span class="p">((</span><span class="n">u850</span> <span class="o">*</span> <span class="n">q850</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> 
                    <span class="p">(</span><span class="n">v850</span> <span class="o">*</span> <span class="n">q850</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">MS_objects</span> <span class="o">=</span> <span class="n">ar_850hpa_tracking</span><span class="p">(</span>
                                        <span class="n">VapTrans</span><span class="p">,</span>
                                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinMSthreshold&quot;</span><span class="p">],</span>
                                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeMS&quot;</span><span class="p">],</span>
                                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinAreaMS&quot;</span><span class="p">],</span>
                                        <span class="n">Area</span><span class="p">,</span>
                                        <span class="n">dT</span><span class="p">,</span>
                                        <span class="n">connectLon</span><span class="p">,</span>
                                        <span class="n">Gridspacing</span><span class="p">,</span>
                                        <span class="n">breakup</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;breakup_ivt&quot;</span><span class="p">])</span>
        
        <span class="n">grMSs</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">MS_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                 <span class="n">VapTrans</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                 <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;MS850_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>        <span class="c1"># output file name and locaiton</span>
                                 <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                 <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                 <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                 <span class="n">Gridspacing</span><span class="p">,</span>
                                 <span class="n">Area</span><span class="p">,</span>
                                 <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeMS&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span>      <span class="c1"># minimum livetime in hours</span>
        
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        
    
    <span class="k">if</span> <span class="n">ar_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;======&gt; track IVT streams and atmospheric rivers (ARs)&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">IVT</span> <span class="o">=</span> <span class="p">(</span><span class="n">ivte</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ivtn</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>

        <span class="n">IVT_objects</span> <span class="o">=</span> <span class="n">ar_ivt_tracking</span><span class="p">(</span><span class="n">IVT</span><span class="p">,</span>
                                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;IVTtrheshold&quot;</span><span class="p">],</span>
                                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeIVT&quot;</span><span class="p">],</span>
                                    <span class="n">dT</span><span class="p">,</span>
                                    <span class="n">Gridspacing</span><span class="p">,</span>
                                    <span class="n">connectLon</span><span class="p">,</span>
                                    <span class="n">breakup</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;breakup_ivt&quot;</span><span class="p">])</span>

        <span class="n">grIVTs</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">IVT_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                     <span class="n">IVT</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                     <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;IVT_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
                                     <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                     <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                     <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                     <span class="n">Gridspacing</span><span class="p">,</span>
                                     <span class="n">Area</span><span class="p">,</span>
                                     <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeIVT&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span>      <span class="c1"># minimum livetime in hours</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        check if MSs quallify as ARs&#39;</span><span class="p">)</span>
        <span class="n">AR_obj</span> <span class="o">=</span> <span class="n">ar_check</span><span class="p">(</span><span class="n">IVT_objects</span><span class="p">,</span>
                         <span class="n">params</span><span class="p">[</span><span class="s2">&quot;AR_Lat&quot;</span><span class="p">],</span>
                         <span class="n">params</span><span class="p">[</span><span class="s2">&quot;AR_width_lenght_ratio&quot;</span><span class="p">],</span>
                         <span class="n">params</span><span class="p">[</span><span class="s2">&quot;AR_MinLen&quot;</span><span class="p">],</span>
                         <span class="n">Lon</span><span class="p">,</span>
                         <span class="n">Lat</span><span class="p">)</span>
    
        <span class="n">grACs</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">AR_obj</span><span class="p">,</span> <span class="c1"># feature object file</span>
                         <span class="n">IVT</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                         <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;ARs_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
                         <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                         <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                         <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                         <span class="n">Gridspacing</span><span class="p">,</span>
                         <span class="n">Area</span><span class="p">)</span>
        
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">front_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;======&gt; identify frontal zones&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        
        <span class="c1"># -------</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">dLon</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">dLat</span>
        <span class="n">du</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u850</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v850</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">PV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">dv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">dx</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">du</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">dy</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span> <span class="p">)</span>
        <span class="n">vgrad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t850</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">Tgrad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vgrad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vgrad</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">Fstar</span> <span class="o">=</span> <span class="n">PV</span> <span class="o">*</span> <span class="n">Tgrad</span>

        <span class="n">Tgrad_zero</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="c1">#*100/(np.mean([dLon,dLat], axis=0)/1000.)  # 0.45 K/(100 km)</span>

        <span class="n">CoriolisPar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calc</span><span class="o">.</span><span class="n">coriolis_parameter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">Lat</span><span class="p">)))</span>
        <span class="n">Frontal_Diagnostic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Fstar</span><span class="o">/</span><span class="p">(</span><span class="n">CoriolisPar</span> <span class="o">*</span> <span class="n">Tgrad_zero</span><span class="p">))</span>
        
        <span class="n">FrontMask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Mask</span><span class="p">)</span>
        <span class="n">FrontMask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Lat</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">Frontal_Diagnostic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Frontal_Diagnostic</span><span class="p">)</span>
        <span class="n">Frontal_Diagnostic</span><span class="p">[:,</span><span class="n">FrontMask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># -------</span>
        
        
        <span class="n">FR_objects</span> <span class="o">=</span> <span class="n">frontal_identification</span><span class="p">(</span><span class="n">Frontal_Diagnostic</span><span class="p">,</span>
                              <span class="n">params</span><span class="p">[</span><span class="s2">&quot;front_treshold&quot;</span><span class="p">],</span>
                              <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinAreaFR&quot;</span><span class="p">],</span>
                              <span class="n">Area</span><span class="p">)</span>
        
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">slp_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;======&gt; track cyclones from PSL&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        
        <span class="n">CY_objects</span><span class="p">,</span> <span class="n">ACY_objects</span><span class="o">=</span> <span class="n">cy_acy_psl_tracking</span><span class="p">(</span>
                                                    <span class="n">slp</span><span class="p">,</span>
                                                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MaxPresAnCY&quot;</span><span class="p">],</span>
                                                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeCY&quot;</span><span class="p">],</span>
                                                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinPresAnACY&quot;</span><span class="p">],</span>
                                                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeACY&quot;</span><span class="p">],</span>
                                                    <span class="n">dT</span><span class="p">,</span>
                                                    <span class="n">Gridspacing</span><span class="p">,</span>
                                                    <span class="n">connectLon</span><span class="p">,</span>
                                                    <span class="n">breakup</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;breakup_cy&quot;</span><span class="p">],</span>
                                                    <span class="p">)</span>

        <span class="n">grCyclonesPT</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">CY_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                         <span class="n">slp</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                         <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;CY_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
                                         <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                         <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                         <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                         <span class="n">Gridspacing</span><span class="p">,</span>
                                         <span class="n">Area</span><span class="p">,</span>
                                         <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeCY&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span> 

        <span class="n">grACyclonesPT</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">ACY_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                         <span class="n">slp</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                         <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;ACY_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
                                         <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                         <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                         <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                         <span class="n">Gridspacing</span><span class="p">,</span>
                                         <span class="n">Area</span><span class="p">,</span>
                                         <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeCY&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span> 

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">z500_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;======&gt; track cyclones from Z500&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">cy_z500_objects</span><span class="p">,</span> <span class="n">acy_z500_objects</span> <span class="o">=</span> <span class="n">cy_acy_z500_tracking</span><span class="p">(</span>
                                            <span class="n">z500</span><span class="p">,</span>
                                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeCY&quot;</span><span class="p">],</span>
                                            <span class="n">dT</span><span class="p">,</span>
                                            <span class="n">Gridspacing</span><span class="p">,</span>
                                            <span class="n">connectLon</span><span class="p">,</span>
                                            <span class="n">z500_low_anom</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;z500_low_anom&quot;</span><span class="p">],</span>
                                            <span class="n">z500_high_anom</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;z500_high_anom&quot;</span><span class="p">],</span>
                                            <span class="n">breakup</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;breakup_zcy&quot;</span><span class="p">],</span>
                                            <span class="p">)</span>
        
        <span class="n">cy_z500_objects_characteristics</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">cy_z500_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                     <span class="n">z500</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                     <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;CY-z500_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
                                     <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                     <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                     <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                     <span class="n">Gridspacing</span><span class="p">,</span>
                                     <span class="n">Area</span><span class="p">,</span>
                                     <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeCY&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span>
        
        <span class="n">acy_z500_objects_characteristics</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">acy_z500_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                                 <span class="n">z500</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                                 <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;ACY-z500_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
                                 <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                                 <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                                 <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                                 <span class="n">Gridspacing</span><span class="p">,</span>
                                 <span class="n">Area</span><span class="p">,</span>
                                 <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeCY&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span> 
        
        <span class="k">if</span> <span class="n">col_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Check if cyclones qualify as Cut Off Low (COL)&#39;</span><span class="p">)</span>
            <span class="n">col_obj</span> <span class="o">=</span> <span class="n">col_identification</span><span class="p">(</span><span class="n">cy_z500_objects</span><span class="p">,</span>
                                   <span class="n">z500</span><span class="p">,</span>
                                   <span class="n">u200</span><span class="p">,</span>
                                   <span class="n">Frontal_Diagnostic</span><span class="p">,</span>
                                   <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeC&quot;</span><span class="p">],</span>
                                   <span class="n">dx</span><span class="p">,</span>
                                   <span class="n">dy</span><span class="p">,</span>
                                   <span class="n">Lon</span><span class="p">,</span>
                                   <span class="n">Lat</span><span class="p">)</span>

            <span class="n">col_stats</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">col_obj</span><span class="p">,</span> <span class="c1"># feature object file</span>
                             <span class="n">z500</span><span class="o">*</span><span class="mf">9.81</span><span class="p">,</span>            <span class="c1"># original file used for feature detection</span>
                             <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;COL_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
                             <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                             <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                             <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                             <span class="n">Gridspacing</span><span class="p">,</span>
                             <span class="n">Area</span><span class="p">,</span>
                             <span class="n">min_tsteps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>      <span class="c1"># minimum livetime in hours</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">mcs_tb_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;======&gt; &#39;check if Tb objects qualify as MCS (or selected storm type)&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">MCS_objects_Tb</span><span class="p">,</span> <span class="n">C_objects</span> <span class="o">=</span> <span class="n">mcs_tb_tracking</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span>
                            <span class="n">pr</span><span class="p">,</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;SmoothSigmaC&quot;</span><span class="p">],</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Pthreshold&quot;</span><span class="p">],</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;CL_Area&quot;</span><span class="p">],</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;CL_MaxT&quot;</span><span class="p">],</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Cthreshold&quot;</span><span class="p">],</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinAreaC&quot;</span><span class="p">],</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeC&quot;</span><span class="p">],</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MCS_minPR&quot;</span><span class="p">],</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MCS_minTime&quot;</span><span class="p">],</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;MCS_Minsize&quot;</span><span class="p">],</span>
                            <span class="n">dT</span><span class="p">,</span>
                            <span class="n">Area</span><span class="p">,</span>
                            <span class="n">connectLon</span><span class="p">,</span>
                            <span class="n">Gridspacing</span><span class="p">,</span>                 
                            <span class="n">breakup</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;breakup_mcs&quot;</span><span class="p">],</span>
                            <span class="n">analyze_mcs_history</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;analyze_mcs_history&quot;</span><span class="p">]</span>
                           <span class="p">)</span>
        
        <span class="n">grCs</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">C_objects</span><span class="p">,</span> <span class="c1"># feature object file</span>
                             <span class="n">tb</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                             <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;Clouds_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
                             <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                             <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                             <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                             <span class="n">Gridspacing</span><span class="p">,</span>
                             <span class="n">Area</span><span class="p">,</span>
                             <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeC&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span>      <span class="c1"># minimum livetime in hours</span>
        
        <span class="n">grMCSs_Tb</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span>
            <span class="n">MCS_objects_Tb</span><span class="p">,</span>  <span class="c1"># feature object file</span>
            <span class="n">pr</span><span class="p">,</span>  <span class="c1"># original file used for feature detection</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;MCSs_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
            <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
            <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
            <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
            <span class="n">Gridspacing</span><span class="p">,</span>
            <span class="n">Area</span><span class="p">)</span>
        
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

    
    <span class="k">if</span> <span class="n">cloud_test</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;======&gt; &#39;track high clouds in Tb field by excluding MCS objects&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">tb_no_mcs</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">tb_no_mcs</span><span class="p">[</span><span class="n">MCS_objects_Tb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">330</span> <span class="c1"># remove MCSs from cloud field</span>
        
        <span class="n">cloud_objects</span> <span class="o">=</span> <span class="n">cloud_tracking</span><span class="p">(</span>
                        <span class="n">tb_no_mcs</span><span class="p">,</span>
                        <span class="n">pr</span><span class="p">,</span>
                        <span class="n">connectLon</span><span class="p">,</span>
                        <span class="n">Gridspacing</span><span class="p">,</span>
                        <span class="n">dT</span><span class="p">,</span>
                        <span class="n">tb_threshold</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Cthreshold&quot;</span><span class="p">],</span>
                        <span class="n">tb_overshoot</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;cloud_overshoot&quot;</span><span class="p">],</span>
                        <span class="n">erosion_disk</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
                        <span class="n">min_dist</span> <span class="o">=</span> <span class="mi">8</span>
                        <span class="p">)</span>

        <span class="n">grclouds_Tb</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span>
            <span class="n">cloud_objects</span><span class="p">,</span>  <span class="c1"># feature object file</span>
            <span class="n">pr</span><span class="p">,</span>  <span class="c1"># original file used for feature detection</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;non-MCS-clouds_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
            <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
            <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
            <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
            <span class="n">Gridspacing</span><span class="p">,</span>
            <span class="n">Area</span><span class="p">)</span>
        
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">tc_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;======&gt; Check if cyclones qualify as TCs&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

        <span class="n">TC_obj</span><span class="p">,</span> <span class="n">TC_Tracks</span> <span class="o">=</span> <span class="n">tc_tracking</span><span class="p">(</span><span class="n">CY_objects</span><span class="p">,</span>
                                        <span class="n">slp</span><span class="p">,</span>
                        <span class="n">t850</span><span class="p">,</span>
                        <span class="n">tb</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u850</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v850</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u200</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v200</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">Lon</span><span class="p">,</span>
                        <span class="n">Lat</span><span class="p">,</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;TC_lat_genesis&quot;</span><span class="p">],</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;TC_T850min&quot;</span><span class="p">]</span>
                       <span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TC_obj, TC_Tracks = tc_tracking(CY_objects,</span>
<span class="sd">                        t850,</span>
<span class="sd">                        slp,</span>
<span class="sd">                        tb,</span>
<span class="sd">                        C_objects,</span>
<span class="sd">                        Lon,</span>
<span class="sd">                        Lat,</span>
<span class="sd">                        params[&quot;TC_lat_genesis&quot;],</span>
<span class="sd">                        params[&quot;TC_deltaT_core&quot;],</span>
<span class="sd">                        params[&quot;TC_T850min&quot;],</span>
<span class="sd">                        params[&quot;TC_Pmin&quot;],</span>
<span class="sd">                        params[&quot;TC_lat_max&quot;],</span>
<span class="sd">                       )</span>
<span class="sd">        &quot;&quot;&quot;</span>

        
        <span class="n">grTCs</span> <span class="o">=</span> <span class="n">calc_object_characteristics</span><span class="p">(</span><span class="n">TC_obj</span><span class="p">,</span> <span class="c1"># feature object file</span>
                             <span class="n">slp</span><span class="o">*</span><span class="mf">100.</span><span class="p">,</span>         <span class="c1"># original file used for feature detection</span>
                             <span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;TC_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">StartDay</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">SetupString</span><span class="p">,</span>
                             <span class="n">Time</span><span class="p">,</span>            <span class="c1"># timesteps of the data</span>
                             <span class="n">Lat</span><span class="p">,</span>             <span class="c1"># 2D latidudes</span>
                             <span class="n">Lon</span><span class="p">,</span>             <span class="c1"># 2D Longitudes</span>
                             <span class="n">Gridspacing</span><span class="p">,</span>
                             <span class="n">Area</span><span class="p">,</span>
                             <span class="n">min_tsteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MinTimeC&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">dT</span><span class="p">))</span>      <span class="c1"># minimum livetime in hours</span>
        <span class="c1">### SAVE THE TC TRACKS TO PICKL FILE</span>
        <span class="n">a_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_TCs_tracks.pkl&#39;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">TC_Tracks</span><span class="p">,</span> <span class="n">a_file</span><span class="p">)</span>
        <span class="n">a_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>  
        
    


    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Save the object masks into a joint netCDF&#39;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="c1"># ============================</span>
    <span class="c1"># Write NetCDF</span>
    <span class="n">iTime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">Time</span> <span class="o">-</span> <span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>

    <span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">NCfile</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4_CLASSIC&#39;</span><span class="p">)</span>
    <span class="n">yc</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span> <span class="n">Lat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">xc</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;xc&#39;</span><span class="p">,</span> <span class="n">Lat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">times</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">,))</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">mcs_tb_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">PR_real</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;PR&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># PR_obj = dataset.createVariable(&#39;PR_Objects&#39;, np.float32,(&#39;time&#39;,&#39;yc&#39;,&#39;xc&#39;),zlib=True)</span>
        <span class="c1"># MCSs = dataset.createVariable(&#39;MCS_Objects&#39;, np.float32,(&#39;time&#39;,&#39;yc&#39;,&#39;xc&#39;),zlib=True)</span>
        <span class="n">MCSs_Tb</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;MCS_Tb_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Cloud_real</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;BT&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Cloud_obj = dataset.createVariable(&#39;BT_Objects&#39;, np.float32,(&#39;time&#39;,&#39;yc&#39;,&#39;xc&#39;),zlib=True)</span>
    <span class="k">if</span> <span class="n">cloud_test</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
        <span class="n">non_mcs_cloud_obj</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;non_mcs_cloud_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">front_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">FR_real</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">FR_obj</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;FR_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">T_real</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;T850&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">slp_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">CY_obj</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;CY_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ACY_obj</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ACY_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">SLP_real</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;SLP&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tc_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">TCs</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;TC_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ms_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">MS_real</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;MS&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">MS_obj</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;MS_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ar_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">IVT_real</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;IVT&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">IVT_obj</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;IVT_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ARs</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;AR_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">z500_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">CY_z500_obj</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;CY_z500_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ACY_z500_obj</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ACY_z500_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Z500_real</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;Z500&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">col_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">COL</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;COL_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">jet_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">JET</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;JET_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">UV200</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;UV200&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ew_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">MRG</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;MRG_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">IGW</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;IGW_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">KELVIN</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;Kelvin_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">EIG</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;EIG0_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ER</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ER_Objects&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;yc&#39;</span><span class="p">,</span><span class="s1">&#39;xc&#39;</span><span class="p">),</span><span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        

    <span class="n">times</span><span class="o">.</span><span class="n">calendar</span> <span class="o">=</span> <span class="s2">&quot;standard&quot;</span>
    <span class="n">times</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;seconds since &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;:00&quot;</span>
    <span class="n">times</span><span class="o">.</span><span class="n">standard_name</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
    <span class="n">times</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>

    <span class="n">lat</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s2">&quot;latitude&quot;</span> <span class="p">;</span>
    <span class="n">lat</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;degrees_north&quot;</span> <span class="p">;</span>
    <span class="n">lat</span><span class="o">.</span><span class="n">standard_name</span> <span class="o">=</span> <span class="s2">&quot;latitude&quot;</span> <span class="p">;</span>

    <span class="n">lon</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s2">&quot;longitude&quot;</span> <span class="p">;</span>
    <span class="n">lon</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;degrees_east&quot;</span> <span class="p">;</span>
    <span class="n">lon</span><span class="o">.</span><span class="n">standard_name</span> <span class="o">=</span> <span class="s2">&quot;longitude&quot;</span> <span class="p">;</span>

    <span class="k">if</span> <span class="n">mcs_tb_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">PR_real</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">PR_real</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;precipitation&quot;</span>
        <span class="n">PR_real</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;mm/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dT</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;h&quot;</span>
        
        <span class="c1"># PR_obj.coordinates = &quot;lon lat&quot;</span>
        <span class="c1"># PR_obj.longname = &quot;precipitation objects&quot;</span>
        <span class="c1"># PR_obj.unit = &quot;&quot;</span>
        
<span class="c1">#         MCSs.coordinates = &quot;lon lat&quot;</span>
<span class="c1">#         MCSs.longname = &quot;MCSs object defined by their precipitation&quot;</span>
<span class="c1">#         MCSs.unit = &quot;&quot;</span>
        
        <span class="n">MCSs_Tb</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">MCSs_Tb</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;MCSs object defined by their Tb&quot;</span>
        <span class="n">MCSs_Tb</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">Cloud_real</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">Cloud_real</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;Tb&quot;</span>
        <span class="n">Cloud_real</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;K&quot;</span>
        
        <span class="c1"># Cloud_obj.coordinates = &quot;lon lat&quot;</span>
        <span class="c1"># Cloud_obj.longname = &quot;Tb objects&quot;</span>
        <span class="c1"># Cloud_obj.unit = &quot;&quot;</span>
    <span class="k">if</span> <span class="n">cloud_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">non_mcs_cloud_obj</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">non_mcs_cloud_obj</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;non MCS cloud object defined by their Tb&quot;</span>
        <span class="n">non_mcs_cloud_obj</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">front_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">FR_real</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">FR_real</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;frontal index&quot;</span>
        <span class="n">FR_real</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">FR_obj</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">FR_obj</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;frontal objects&quot;</span>
        <span class="n">FR_obj</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">T_real</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">T_real</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;850 hPa air temperature&quot;</span>
        <span class="n">T_real</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;K&quot;</span>
    <span class="k">if</span> <span class="n">slp_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">CY_obj</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">CY_obj</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;cyclone objects from SLP&quot;</span>
        <span class="n">CY_obj</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">ACY_obj</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">ACY_obj</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;anticyclone objects from SLP&quot;</span>
        <span class="n">ACY_obj</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">SLP_real</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">SLP_real</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;sea level pressure (SLP)&quot;</span>
        <span class="n">SLP_real</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;Pa&quot;</span>
    <span class="k">if</span> <span class="n">ms_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">MS_real</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">MS_real</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;850 hPa moisture flux&quot;</span>
        <span class="n">MS_real</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;g/g m/s&quot;</span>
        
        <span class="n">MS_obj</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">MS_obj</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;mosture streams objects according to 850 hPa moisture flux&quot;</span>
        <span class="n">MS_obj</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ar_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">IVT_real</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">IVT_real</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;vertically integrated moisture transport&quot;</span>
        <span class="n">IVT_real</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;kg m−1 s−1&quot;</span>
        
        <span class="n">IVT_obj</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">IVT_obj</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;IVT objects&quot;</span>
        <span class="n">IVT_obj</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">ARs</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">ARs</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;atmospheric river objects&quot;</span>
        <span class="n">ARs</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tc_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">TCs</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">TCs</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;tropical cyclone objects&quot;</span>
        <span class="n">TCs</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">z500_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">CY_z500_obj</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">CY_z500_obj</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;cyclone objects according to Z500&quot;</span>
        <span class="n">CY_z500_obj</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">ACY_z500_obj</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">ACY_z500_obj</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;anticyclone objects according to Z500&quot;</span>
        <span class="n">ACY_z500_obj</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">Z500_real</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">Z500_real</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;500 hPa geopotential height&quot;</span>
        <span class="n">Z500_real</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;gpm&quot;</span>
    <span class="k">if</span> <span class="n">col_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">COL</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">COL</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;cut off low objects&quot;</span>
        <span class="n">COL</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">jet_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">JET</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">JET</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;jet stream objects&quot;</span>
        <span class="n">JET</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">UV200</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">UV200</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;200 hPa wind speed&quot;</span>
        <span class="n">UV200</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;m s-1&quot;</span>
    <span class="k">if</span> <span class="n">ew_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">MRG</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">MRG</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;Mixed Rosby Gravity wave objects&quot;</span>
        <span class="n">MRG</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">IGW</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">IGW</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;Inertia Gravity wave objects&quot;</span>
        <span class="n">IGW</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">KELVIN</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">KELVIN</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;Kelvin wave objects&quot;</span>
        <span class="n">KELVIN</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">EIG</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">EIG</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;Eastward Inertio Gravirt wave objects&quot;</span>
        <span class="n">EIG</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">ER</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s2">&quot;lon lat&quot;</span>
        <span class="n">ER</span><span class="o">.</span><span class="n">longname</span> <span class="o">=</span> <span class="s2">&quot;Equatorial Rossby wave objects&quot;</span>
        <span class="n">ER</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">lat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">Lat</span>
    <span class="n">lon</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">Lon</span>
    <span class="k">if</span> <span class="n">mcs_tb_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">PR_real</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">pr</span>
        <span class="c1"># PR_obj[:] = PR_objects</span>
        <span class="c1"># MCSs[:] = MCS_obj</span>
        <span class="n">MCSs_Tb</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">MCS_objects_Tb</span>
        <span class="n">Cloud_real</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">tb</span>
        <span class="c1"># Cloud_obj[:] = C_objects</span>
    <span class="k">if</span> <span class="n">cloud_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">non_mcs_cloud_obj</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">cloud_objects</span>
    <span class="k">if</span> <span class="n">front_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">FR_real</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">Frontal_Diagnostic</span>
        <span class="n">FR_obj</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">FR_objects</span>
        <span class="n">T_real</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">t850</span>
    <span class="k">if</span> <span class="n">tc_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">TCs</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">TC_obj</span>
    <span class="k">if</span> <span class="n">slp_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">CY_obj</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">CY_objects</span>
        <span class="n">ACY_obj</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">ACY_objects</span>
        <span class="n">SLP_real</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">slp</span>
    <span class="k">if</span> <span class="n">ms_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">MS_real</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">VapTrans</span>
        <span class="n">MS_obj</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">MS_objects</span>
    <span class="k">if</span> <span class="n">ar_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">IVT_real</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">IVT</span>
        <span class="n">IVT_obj</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">IVT_objects</span>
        <span class="n">ARs</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">AR_obj</span>
    <span class="k">if</span> <span class="n">z500_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">CY_z500_obj</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">cy_z500_objects</span>
        <span class="n">ACY_z500_obj</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">acy_z500_objects</span>
        <span class="n">Z500_real</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">z500</span>
    <span class="k">if</span> <span class="n">col_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">COL</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">col_obj</span>
    <span class="k">if</span> <span class="n">jet_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">JET</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">jet_objects</span>
        <span class="n">UV200</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">uv200</span>
    <span class="k">if</span> <span class="n">ew_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">MRG</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mrg_objects</span>
        <span class="n">IGW</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">igw_objects</span>
        <span class="n">KELVIN</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">kelvin_objects</span>
        <span class="n">EIG</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">eig0_objects</span>
        <span class="n">ER</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">er_objects</span>
                
    <span class="n">times</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">iTime</span>
    
    <span class="c1"># SET GLOBAL ATTRIBUTES</span>
    <span class="c1"># Add global attributes</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;MOAAP object tracking output&quot;</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">contact</span> <span class="o">=</span> <span class="s2">&quot;Andreas F. Prein (prein@ucar.edu)&quot;</span>
    <span class="c1"># dataset.breakup = &#39;The &#39; + breakup + &quot; method has been used to segment the objects&quot;</span>

    <span class="n">dataset</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved: &#39;</span><span class="o">+</span><span class="n">NCfile</span><span class="p">)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">timer</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tc_test</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="c1">### SAVE THE TC TRACKS TO PICKL FILE</span>
        <span class="c1"># ============================</span>
        <span class="n">a_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;OutputFolder&quot;</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_TCs_tracks.pkl&#39;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">TC_Tracks</span><span class="p">,</span> <span class="n">a_file</span><span class="p">)</span>
        <span class="n">a_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
    <span class="k">if</span> <span class="s1">&#39;object_split&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">object_split</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">object_split</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">object_split</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Andreas F. Prein, Raphael Graf.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>